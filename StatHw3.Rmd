---
title: "Stat_Hw3"
author: "Ellie Suit, Andy Atallah, and Ai Hattori"
date: "2023-10-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Research Question: 

Types of Trees: 
- Decision/Regression Tree (rpart) - simplist model 
- Bagged Trees (ipred) - making a bunch of similar trees with different observations and determining oob 
- Random Forest (randomforest) - making a bunch of weak learners and taking majority vote
- Boosting Trees (xgboost) - making one tree model and predicting the error for a given variable X 

```{r}
# import libraries
library(lubridate)
library(sf)
library(tidyverse)
library(rattle)
library(rpart)

# factor-ize variables
stop_data <- stop_data %>%
  mutate(time = as_datetime(responseDate),
         year = year(time),
         month = month(time),
         day = day(time),
         race = factor(race),
         gender = factor(gender),
         preRace = factor(preRace),
         policePrecinct = factor(policePrecinct),
         problem = factor(problem)) 


```

```{r}
gf_date <- as.Date("2020-05-25")
stop_data <- stop_data %>%
  mutate(case = case_when(time <= gf_date ~ 0,
                          time > gf_date ~ 1))

before_gf <- stop_data %>%
  filter(case == 0) 
after_gf <- stop_data %>%
  filter(case == 1) %>%
  mutate(race = factor(race),
  gender = factor(gender),
  preRace = factor(preRace),
  policePrecinct = factor(policePrecinct),
  problem = factor(problem)) 

```


# Decision Tree
```{r}
tree <- rpart(problem ~ race + gender + preRace, data = before_gf)
fancyRpartPlot(tree)
```


# Random Forest
```{r}
library(ranger)
rf <- randomForest(problem ~ race + gender + preRace + policePrecinct, 
                   data = before_gf %>% na.omit(),
                   importance = TRUE)

after_gf_revised <- after_gf %>%
  mutate(problem = droplevels(problem))
rf2 <- ranger(problem ~ gender + preRace, 
                   data = after_gf_revised %>% na.omit(),
              importance = 'impurity')
table(after_gf_revised$problem)
table(levels(after_gf_revised$problem))

rf2$variable.importance
```




