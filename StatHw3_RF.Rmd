---
title: "Stat_Hw3"
author: "Ellie Suit, Andy Atallah, and Ai Hattori"
date: "2023-10-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Research Question: 
Analyze vehicleSearch before and after George Floyd incident
- Use race, preRace, gender, policePrecinct, reason, problem, lat, long as a predictor variable 


Types of Trees: 
- Decision/Regression Tree (rpart) - simplist model 
- Bagged Trees (ipred) - making a bunch of similar trees with different observations and determining oob 
- Random Forest (randomforest) - making a bunch of weak learners and taking majority vote
- Boosting Trees (xgboost) - making one tree model and predicting the error for a given variable X 



```{r}
# import libraries
library(lubridate)
library(sf)
library(tidyverse)
library(rattle)
library(rpart)


# read in csv
stop_data <- read_csv("Minneapolis_Police_Stop_Data.csv")
  
stop_data_factored <- stop_data %>%
  na.omit() %>%
  mutate(time = as_datetime(responseDate),
         reason = factor(reason),
         problem = factor(problem),
         citationIssued = factor(citationIssued),
         personSearch = factor(personSearch),
         vehicleSearch = factor(vehicleSearch),
         preRace = factor(preRace),
         race = factor(race),
         gender = factor(gender),
         policePrecinct = factor(policePrecinct))

stop_data_factored <- stop_data_factored %>%
  mutate(vehicleSearch = case_when(vehicleSearch == 'NO' ~ 0,
                                   vehicleSearch == 'YES' ~ 1),
         personSearch = case_when(personSearch == 'NO' ~ 0,
                                   personSearch == 'YES' ~ 1),
         citationIssued = case_when(citationIssued == 'NO' ~ 0,
                                   citationIssued == 'YES' ~ 1))



```


```{r}
gf_date <- as.Date("2020-05-26")
stop_data_factored <- stop_data_factored %>%
  mutate(case = case_when(time <= gf_date ~ 0,
                          time > gf_date ~ 1)) %>%
  mutate(case = factor(case))

before_gf <- stop_data_factored %>%
  filter(case == 0) 
after_gf <- stop_data_factored %>%
  filter(case == 1)


```
```{r}
table(stop_data_factored$race)
```


# Decision Tree
```{r}
#view(stop_data_factored)

tree <- rpart(personSearch ~ race + gender + policePrecinct + reason + problem + case + lat + long + preRace, data = stop_data_factored) 

#TODO: why does this not work for a binary variable vehicleSearch? 
fancyRpartPlot(tree)

```

```{r}
tree1 <- rpart(vehicleSearch ~ race + gender + policePrecinct + reason + problem + case + lat + long + preRace, data = stop_data_factored) 

#TODO: why does this not work for a binary variable vehicleSearch? 
fancyRpartPlot(tree1)
```

# Random Forest

```{r}
library(randomForest)
rf1 <- randomForest(preRace ~ reason + problem + gender + policePrecinct + night + lat + long, data = stop_data_factored, mtry = 4, importance = TRUE) 

rf2 <- randomForest(race ~ reason + problem  + personSearch + gender + policePrecinct + lat + long, data = stop_data_factored, mtry = 4, importance = TRUE)


view(rf1$importance)

view(rf2$importance) 

rf1
rf2
```






